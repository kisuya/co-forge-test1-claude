# PRD: oh-my-stock

## Overview

관심 종목의 주가가 크게 변동했을 때, AI가 뉴스와 공시를 분석해 **왜 변동했는지** 심층 리포트를 제공하는 독립 웹 서비스.

증권사 계좌 불필요. 누구나 사용 가능.

## Target User

- 1년 이상 주식 투자 경험이 있는 한국 개인투자자 (30-50대)
- 매일 증권 앱 확인, 주가 변동 시 "왜?"가 궁금하지만 직접 찾아볼 시간 부족
- 2개 이상 증권사 계좌 보유, 특정 증권사에 종속되지 않는 도구를 원함

## Core Features

### P0: Must Have

#### F1. 관심 종목 등록/관리
- Description: 사용자가 한국 주식 종목을 검색하고 관심 목록에 추가/제거
- Acceptance criteria:
  - [ ] 종목명 또는 종목코드로 검색 시 500ms 이내 결과 반환
  - [ ] 최대 50개 종목 등록 가능
  - [ ] 등록된 종목 목록을 대시보드에서 확인 가능
  - [ ] 종목 제거 시 관련 알림도 함께 제거
  - [ ] 종목 추가 후 검색 결과 목록 자동 닫힘
  - [ ] 검색 UX 개선: 디바운스 자동검색, 결과 하이라이트, 빈 결과 안내, 최근 검색어

#### F2. 주가 급변동 감지
- Description: 등록된 종목의 주가를 주기적으로 확인하고, 유의미한 변동 발생 시 감지
- Acceptance criteria:
  - [ ] 장중 30분 간격으로 등록 종목의 주가 변동률 체크
  - [ ] 일일 변동률 ±3% 이상 시 "급변동" 이벤트 생성
  - [ ] 변동률 임계값은 사용자가 설정 가능 (기본값 3%)
  - [ ] 감지된 이벤트는 대시보드에 즉시 표시

#### F3. AI 변동 원인 분석 리포트
- Description: 급변동 감지 시 관련 뉴스/공시를 수집하고 LLM으로 변동 원인을 분석한 리포트 생성
- Acceptance criteria:
  - [ ] 급변동 감지 후 30분 이내에 리포트 생성 완료
  - [ ] 리포트 구성: 변동 요약 (1줄), 주요 원인 (1-3개), 관련 뉴스/공시 링크, 영향 분석
  - [ ] 각 원인에 확신도(높음/중간/낮음) 표시
  - [ ] 복수 원인이 있을 경우 중요도 순으로 정렬
  - [ ] 원본 뉴스/공시 링크를 출처로 제공
  - [ ] AI 판단 로직 명확화: 급변동 감지 → 뉴스/공시 수집 → 원인 분류(직접/간접/거시) → 확신도 산출의 프로세스가 투명하게 동작

#### F4. 대시보드 (웹)
- Description: 등록 종목 현황과 분석 리포트를 한눈에 볼 수 있는 웹 대시보드
- Acceptance criteria:
  - [ ] 등록 종목 목록 + 현재 변동률 표시
  - [ ] 급변동 발생 종목은 시각적으로 강조 (색상 구분)
  - [ ] 종목 클릭 시 최근 리포트 목록 확인 가능
  - [ ] 리포트 클릭 시 전체 분석 내용 표시
  - [ ] 반응형 웹 (모바일 브라우저에서도 사용 가능)
  - [ ] StockCard에 수집기의 최신 시세 데이터 연동 표시 (현재가, 전일 대비 변동률, 변동금액)
  - [ ] 한국 종목: KRW 가격, 미국 종목: USD 가격 표시
  - [ ] 시세 데이터 미수집 상태일 때 "시세 대기중" 안내 표시 ("-" 대신)

#### F5. 사용자 인증
- Description: 이메일 기반 회원가입/로그인
- Acceptance criteria:
  - [ ] 이메일 + 비밀번호로 회원가입/로그인
  - [ ] JWT 기반 인증, 토큰 만료 시 자동 갱신
  - [ ] 비밀번호 해싱 (bcrypt)
  - [ ] 로그인 상태 유지 (7일)

### P1: Should Have

#### F6. 미국 주식 지원
- Description: 미국 주요 종목(S&P 500) 추가 지원
- Acceptance criteria:
  - [ ] US 종목 검색 및 등록
  - [ ] 미국 장 시간에 맞춘 변동 감지
  - [ ] 영문 뉴스 기반 분석 리포트 (한국어로 제공)

#### F7. 유사 과거 케이스 매칭
- Description: 현재 변동과 유사한 과거 사례를 찾아 비교 분석
- Acceptance criteria:
  - [ ] 동일 종목의 유사 변동 패턴 최소 3건 제시
  - [ ] 각 과거 사례의 이후 주가 추이 (1주/1개월) 표시
  - [ ] 현재 상황과 과거 사례의 유사점/차이점 분석
  - [ ] 존재하지 않는 report_id 요청 시 404 반환 (500 금지)
  - [ ] 유효하지 않은 파라미터 시 422 반환

#### F8. 알림 설정
- Description: 급변동 발생 시 웹 푸시 알림
- Acceptance criteria:
  - [ ] 브라우저 Web Push 알림 지원
  - [ ] 알림 ON/OFF 설정 가능
  - [ ] 종목별 알림 개별 설정 가능
  - [ ] /notifications 페이지에서 전체 알림 이력 조회 가능 (최신순, 페이지네이션)
  - [ ] GET /api/notifications 엔드포인트로 알림 목록 반환 (현재 404 해소)

#### F9. 종목 이벤트 히스토리 (P2→P1 승격)
- Description: 관심목록에 1명 이상 등록된 종목에 대해서만 주요 이벤트(급변동 감지, 리포트 생성)를 타임라인으로 누적 제공. 추적 사용자가 없는 기간에는 히스토리가 존재하지 않으며, 누적된 히스토리는 해당 종목을 추적하는 모든 사용자에게 공유. 전체 종목 무차별 수집 대비 효율적이고, 사용자 관심 기반으로 자연스럽게 데이터가 축적되는 구조.
- Acceptance criteria:
  - [ ] 종목 상세 페이지에서 이벤트 히스토리 타임라인 제공 (최신순)
  - [ ] 이벤트 항목: 날짜, 변동률(상승 빨강/하락 파랑 색상 구분), 원인 요약(1줄), 확신도 뱃지
  - [ ] 이벤트 클릭 시 해당 리포트 상세 페이지로 이동
  - [ ] 관심목록에 1명 이상 등록된 종목에 대해서만 이벤트 누적 (기존 수집기 로직과 동일 — 관심목록 종목만 모니터링)
  - [ ] 아무도 추적하지 않던 기간의 히스토리는 존재하지 않음 → "이 기간에는 추적 데이터가 없습니다" 안내
  - [ ] 추적 사용자가 0→1명 되는 시점부터 히스토리 수집 시작
  - [ ] 누적된 히스토리는 해당 종목을 추적하는 모든 사용자에게 동일하게 공유 (1회 생성, N명 표시)
  - [ ] 새로 추적 시작한 사용자도 기존 누적 히스토리 전체 열람 가능 (뒤늦게 합류해도 과거 데이터 접근)
  - [ ] 히스토리 20건 초과 시 "더 보기" 페이지네이션
  - [ ] 빈 상태: "아직 추적 이벤트가 없습니다. 급변동이 감지되면 자동으로 기록됩니다"
  - [ ] 종목 추가 시 토스트: "종목 추적이 시작되었습니다"

#### F12. 종목 추적 현황 및 관리 메뉴
- Description: StockCard에 해당 종목을 추적 중인 사용자 수를 표시하여 종목 인기도를 한눈에 파악하게 하고, 종목별 관리 기능(임계값 설정, 알림, 히스토리, 제거)을 통합 ⋮ 메뉴로 제공하여 접근성 개선. 기존 ⚙️ 아이콘이 눈에 띄지 않는 문제 해소.
- Acceptance criteria:
  - [ ] StockCard에 "N명 추적 중" 표시 (해당 종목을 관심목록에 등록한 전체 사용자 수)
  - [ ] 추적 수는 페이지 로드 시 갱신 (실시간 불필요)
  - [ ] 1명일 때 "1명 추적 중", 0명일 때 미표시
  - [ ] 기존 ⚙️ 아이콘을 ⋮ (kebab/더보기) 메뉴로 변경
  - [ ] 메뉴 항목 구성: 이벤트 히스토리 보기 | 알림 ON/OFF 토글 | 변동 감지 임계값 설정 | 관심목록에서 제거
  - [ ] 임계값 설정은 메뉴 내 인라인 스텝퍼 유지 (±0.5% 단위, 1%~10% 범위)
  - [ ] 알림 토글은 현재 ON/OFF 상태를 시각적으로 표시
  - [ ] "관심목록에서 제거" 클릭 시 확인 다이얼로그 ("정말 제거하시겠습니까? 이 종목의 알림도 함께 해제됩니다")
  - [ ] 데스크톱: 드롭다운 메뉴 (카드 우측 상단 기준), 모바일: 바텀시트 패턴
  - [ ] 키보드 접근성: Escape로 닫기, 화살표 키 탐색
  - [ ] 메뉴 외부 클릭 시 자동 닫힘

#### F13. 마이페이지 및 프로필
- Description: 사용자 프로필 관리와 활동 현황을 한눈에 확인할 수 있는 마이페이지. 닉네임 설정으로 토론 등에서 이메일 노출 방지. 실제 서비스 수준의 계정 관리 제공.
- Acceptance criteria:
  - [ ] /mypage 라우트에서 사용자 프로필 정보 표시 (닉네임, 이메일, 가입일)
  - [ ] 닉네임 설정/수정 (2~20자, 한글/영문/숫자, 중복 불가)
  - [ ] 닉네임 미설정 시 이메일 '@' 앞부분을 기본값으로 사용
  - [ ] 활동 통계 표시: 관심 종목 수, 받은 리포트 수, 작성 토론 글 수
  - [ ] 비밀번호 변경 기능 (현재 비밀번호 확인 → 새 비밀번호 입력)
  - [ ] 토론/댓글에서 닉네임으로 표시 (이메일 노출 금지)
  - [ ] 반응형 레이아웃 (모바일 대응)

#### F14. 글로벌 레이아웃 및 제품 마감
- Description: 실제 서비스 수준의 글로벌 레이아웃(네비게이션, 랜딩 페이지, 푸터)과 제품 마감 디테일(SEO, 로딩 UX, 에러 페이지)을 구현하여 프로토타입이 아닌 완성된 제품 느낌 확보. Next.js App Router의 layout.tsx, loading.tsx, error.tsx, not-found.tsx, Metadata API를 적극 활용.
- Acceptance criteria:
  - [ ] 글로벌 헤더: 로고(oh-my-stock, 클릭→대시보드) + 네비게이션(대시보드 | 마이페이지) + 알림 벨 + 프로필 아이콘
  - [ ] 프로필 메뉴에 로그아웃 옵션 포함 (클릭 시 JWT 삭제 + 로그인 페이지 리다이렉트)
  - [ ] 모바일(768px 이하): 하단 탭 바 (대시보드 | 리포트 | 마이페이지) 또는 햄버거 메뉴
  - [ ] 랜딩 페이지(/): 비로그인 사용자에게 서비스 소개 + "무료로 시작하기" CTA → 회원가입 페이지
  - [ ] 로그인 사용자가 / 접근 시 대시보드로 리다이렉트
  - [ ] 글로벌 푸터: "본 서비스는 투자 조언을 제공하지 않습니다" 면책 조항 + 이용약관 + 개인정보처리방침 링크
  - [ ] Next.js Metadata API로 페이지별 title, description, OG 이미지 설정
  - [ ] Favicon + apple-touch-icon 설정
  - [ ] loading.tsx + Suspense로 주요 페이지(대시보드, 리포트, 종목 상세) 스켈레톤 UI
  - [ ] not-found.tsx 커스텀 404 페이지 ("페이지를 찾을 수 없습니다" + 대시보드 링크)
  - [ ] error.tsx 커스텀 에러 페이지 (전역 에러 바운더리와 통합)
  - [ ] 일관된 타이포그래피 (Pretendard 또는 Noto Sans KR)

#### F19. 종목 리스트 동적 갱신
- Description: 현재 시드 30개(KRX)+101개(US) 고정 종목을 KRX/NASDAQ/NYSE 전체 종목으로 동적 확장하여 사용자가 모든 상장 종목을 검색·등록할 수 있도록 개선
- Acceptance criteria:
  - [ ] KRX 전체 종목(2,500+)을 주기적으로 동기화 (상장/상폐 반영)
  - [ ] NASDAQ/NYSE 전체 종목(6,000+)을 주기적으로 동기화
  - [ ] 신규 상장 종목이 자동으로 검색 대상에 포함
  - [ ] 상폐 종목은 검색에서 제외되되, 기존 히스토리 데이터 보존
  - [ ] 동기화 주기: 일 1회 (장 마감 후)

### P2: Nice to Have

#### F10. 리포트 공유
- Description: 분석 리포트를 URL로 공유 가능
- Acceptance criteria:
  - [ ] 리포트 상세 페이지에서 "공유" 버튼 클릭 시 고유 공유 URL 생성
  - [ ] 공유 URL 접속 시 로그인 없이 리포트 내용 조회 가능 (읽기 전용)
  - [ ] 공유 URL에 만료 기간 설정 (기본 30일)
  - [ ] 클립보드 복사 기능 제공

#### F11. 커뮤니티 토론
- Description: 종목별 사용자 토론 공간
- Acceptance criteria:
  - [ ] 종목별 토론 게시판 (최신순 정렬)
  - [ ] 텍스트 기반 글 작성/수정/삭제 (본인 글만)
  - [ ] 댓글 1단계 지원
  - [ ] 로그인 사용자만 글/댓글 작성 가능, 비로그인은 읽기만

#### F15. 시장 데일리 브리핑
- Description: 매일 장 마감 후 주요 시장 이슈를 AI가 요약하여 제공. 사용자가 매일 서비스를 방문할 이유를 만들어 DAU 증가에 기여. 급변동이 없는 날에도 서비스 가치 유지.
- Acceptance criteria:
  - [ ] 매일 장 마감 후 (15:30 KST 이후) 시장 브리핑 자동 생성
  - [ ] 브리핑 구성: 코스피/코스닥 등락 요약, 주요 이슈 3-5개, 특징주 하이라이트
  - [ ] 대시보드 상단에 "오늘의 시장" 카드로 표시
  - [ ] 과거 브리핑 아카이브 열람 가능 (최근 30일)
  - [ ] 미국 시장 브리핑 별도 제공 (한국 시간 기준 익일 오전)

#### F16. 관심 종목 뉴스 피드
- Description: 사용자가 추적 중인 종목에 관련된 뉴스를 실시간으로 수집하여 피드 형태로 제공. 급변동이 아닌 일상적인 뉴스도 확인 가능하여 체류 시간 증가 및 급변동 외 서비스 가치 확대.
- Acceptance criteria:
  - [ ] 추적 중인 종목의 관련 뉴스를 종합 피드로 표시 (최신순)
  - [ ] 뉴스별 AI 1줄 요약 + 관련 종목 태그 표시
  - [ ] 종목별 필터링 가능
  - [ ] 뉴스 클릭 시 원문 링크로 이동
  - [ ] 중요도 표시 (AI가 주가 영향력 기준으로 분류: 높음/보통/낮음)
  - [ ] 1시간 간격으로 뉴스 갱신

#### F17. 인기/트렌딩 종목
- Description: 서비스 내 추적 수 기반의 인기 종목 및 급변동 발생 빈도 기반의 트렌딩 종목을 노출하여 새로운 종목 발견 기회 제공. 바이럴 효과와 신규 사용자 유입에 기여.
- Acceptance criteria:
  - [ ] 대시보드 사이드바 또는 별도 페이지에 인기/트렌딩 종목 표시
  - [ ] 인기 종목: 추적 사용자 수 상위 10개 (일간 기준)
  - [ ] 트렌딩 종목: 최근 24시간 급변동 이벤트 발생 종목 (변동률 순)
  - [ ] 각 종목: 종목명, 현재가, 변동률, 추적 수 표시
  - [ ] 종목 클릭 시 종목 상세 페이지로 이동
  - [ ] 비로그인 사용자에게도 노출 (회원가입 유도)

#### F18. 마켓 캘린더
- Description: 주요 경제 지표 발표, 실적 발표 일정, FOMC 등 시장에 영향을 미치는 이벤트 캘린더 제공. "왜 변동했는가"의 보완으로 "앞으로 뭐가 있는가"에 대한 예측 가치 제공.
- Acceptance criteria:
  - [ ] 월간 캘린더 뷰로 주요 이벤트 표시
  - [ ] 이벤트 유형: 실적 발표, 경제 지표 발표 (CPI, 고용, GDP 등), 중앙은행 회의 (FOMC, 금통위), 배당 일정
  - [ ] 사용자 추적 종목의 관련 이벤트 강조 표시
  - [ ] 이벤트 클릭 시 상세 설명 + 과거 동일 이벤트의 시장 영향 요약
  - [ ] 이번 주 주요 이벤트 요약 카드 (대시보드 위젯)
  - [ ] 한국/미국 이벤트 구분 표시

## Won't Have

검토했으나 의도적으로 제외한 기능:

- **매매 추천 / 투자 조언** — 금융투자업 규제 리스크. 면책 조항으로 대체
- **자동 매매 연동** — 증권사 API 연동 복잡도 + 법적 책임 문제
- **암호화폐 / 채권 / 파생상품** — 한국 주식에 집중. 데이터 소스/분석 로직이 완전히 다름

## Out of Scope

현재 버전에서 제외하되, 향후 검토 가능:

- 실시간 주가 차트 (증권사 앱 역할, 우선순위 낮음)
- 모바일 네이티브 앱 (웹 반응형으로 대체)
- 소셜 로그인 (v1에서는 이메일만, v2에서 검토)

## Success Metrics

- **활성화율**: 가입 후 7일 내 종목 3개 이상 등록한 비율 > 60%
- **30일 리텐션**: 30일 후에도 주 1회 이상 방문 > 40%
- **핵심 액션 빈도**: 사용자당 주간 리포트 조회 수 > 5회
- **리포트 품질**: 사용자 피드백 "도움이 됐다" 비율 > 70%

## Constraints

- LLM API 비용: 리포트당 예상 $0.05-0.10 → 월 1만 리포트 기준 $500-1,000
- DART API: 일 10,000건 호출 제한 (무료)
- KRX 데이터: 실시간이 아닌 15-30분 지연 데이터 사용
- 한국 장 운영 시간: 09:00-15:30 KST
- 금융투자업 규제: "투자 조언"으로 분류되지 않도록 면책 조항 필수
- 모든 API 에러 응답(4xx, 5xx)에 CORS 헤더 포함 필수 — 에러 응답에서 CORS 헤더 누락 시 브라우저가 CORS 에러로 오인하여 디버깅 혼란 유발
